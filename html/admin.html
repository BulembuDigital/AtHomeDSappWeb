<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin · At Home Driving School</title>

  <!-- Icons -->
  <link rel="icon" type="image/png" href="/icons/favicon-32.png">
  <link rel="apple-touch-icon" href="/icons/apple-icon-180.png">

  <!-- Base Styles -->
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/ui-sparkle.css">
  <link rel="stylesheet" href="/css/splash.css">

  <!-- Theme + UI Controllers -->
  <script defer src="/js/theme.js"></script>
  <script defer src="/js/ui-sparkle.js"></script>
  <script defer src="/js/splash.js"></script>

  <!-- Supabase Core -->
  <script defer src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <!-- SDK (App Logic) -->
  <script type="module" src="/js/supabaseClient.js"></script>
  <script type="module" src="/js/sdk/auth.js"></script>
  <script type="module" src="/js/sdk/profiles.js"></script>
  <script type="module" src="/js/sdk/assignments.js"></script>
  <script type="module" src="/js/sdk/materials.js"></script>
  <script type="module" src="/js/sdk/messages.js"></script>
  <script type="module" src="/js/sdk/analytics.js"></script>
  <script type="module" src="/js/sdk/storage.js"></script>

  <!-- Page Logic -->
  <script type="module" src="/js/admin.js"></script>

  <style>
    /* Tabs */
    .tabs {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      border-bottom: 1px solid var(--border);
    }
    .tab {
      padding: 10px 16px;
      border-radius: 12px 12px 0 0;
      font-weight: 700;
      cursor: pointer;
      transition: 0.25s;
      color: var(--text-dim);
      border: 1px solid transparent;
    }
    .tab.active {
      background: var(--bg-elev);
      color: var(--text);
      border-color: var(--border) var(--border) transparent var(--border);
      position: relative;
    }
    .tab.active::after {
      content: "";
      position: absolute;
      left: 12px;
      right: 12px;
      bottom: -1px;
      height: 2px;
      background: var(--accent);
      border-radius: 2px;
    }

    .panel {
      display: none;
      padding-top: 20px;
      animation: fade .25s ease;
    }
    .panel.active { display: block; }
    @keyframes fade { from { opacity: 0; } to { opacity: 1; } }

    .kpis {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 14px;
      margin-top: 16px;
    }
    .kpi {
      padding: 16px;
      border-radius: var(--radius);
      background: var(--bg-elev);
      border: 1px solid var(--border);
    }

    .kpi .label { font-size: 12px; color: var(--text-dim); }
    .kpi .value { font-size: 28px; font-weight: 800; }

    .charts {
      display: grid;
      gap: 16px;
      margin-top: 18px;
      grid-template-columns: 1fr 1fr;
    }
    @media (max-width: 900px) {
      .charts { grid-template-columns: 1fr; }
    }

    .chart-card {
      padding: 16px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--bg-elev);
    }

    .list-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 20px;
    }
    @media (max-width: 1000px) {
      .grid-2 { grid-template-columns: 1fr; }
    }

    .grid-3 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
    }

    .avatar {
      width: 92px;
      height: 92px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--border);
    }

    .pad { padding: 18px; }
    .wrap { flex-wrap: wrap; }
    .spaced { margin-top: 14px; }

    /* Perfect Sun / Moon Button */
    .theme-toggle {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      border: 1px solid var(--border);
      background: var(--bg-elev);
      display: grid;
      place-items: center;
      cursor: pointer;
      transition: background .3s, transform .2s;
    }
    .theme-toggle:hover {
      transform: translateY(-1px);
      background: var(--bg-card);
    }
    .theme-toggle svg {
      width: 22px;
      height: 22px;
      stroke: var(--text);
      transition: stroke .25s ease;
    }
  </style>

</head>

<body class="soft-page">

<!-- Splash Screen -->
<div class="splash-overlay show">
  <div class="splash">
    <div class="logo-wrap">
      <img class="logo" src="/icons/logo-512.png" alt="Logo">
      <div class="glow"></div>
      <div class="bloom"></div>
    </div>
    <div class="loader">
      <div class="dot"></div><div class="dot"></div><div class="dot"></div>
    </div>
  </div>
</div>

<header class="header card-gradient">
  <div class="brand"><span class="dot"></span> Admin Dashboard</div>

  <div class="row" style="gap:12px;">
    <button class="btn" onclick="location.href='/html/home.html'">Home</button>

    <button class="btn danger" id="logoutBtn">Logout</button>

    <!-- THE NEW DAY/NIGHT TOGGLE -->
    <button id="themeToggleBtn" class="theme-toggle">
      <!-- Default icon (auto switches) -->
      <svg id="themeIcon" viewBox="0 0 24 24" fill="none">
        <circle cx="12" cy="12" r="5" stroke-width="2"/>
      </svg>
    </button>
  </div>
</header>

<main class="container">

  <!-- Tabs -->
  <nav class="tabs" id="tabs">
    <button class="tab active" data-tab="analytics">Analytics</button>
    <button class="tab" data-tab="approvals">Approvals</button>
    <button class="tab" data-tab="assign">Assignments</button>
    <button class="tab" data-tab="materials">Materials</button>
    <button class="tab" data-tab="messages">Messages</button>
    <button class="tab" data-tab="clock">Clock</button>
    <button class="tab" data-tab="profile">Profile</button>
  </nav>

  <!-- Analytics -->
  <section class="panel active" data-panel="analytics">
    <div class="card card-gradient pad">

      <div class="row wrap" style="gap:10px;">
        <div class="pill">My Zone: <strong id="anMyZone">—</strong></div>
        <div class="pill">Window: last 7 days</div>
        <button id="anRefresh" class="btn" style="margin-left:auto;">Refresh</button>
      </div>

      <div class="kpis">
        <div class="kpi">
          <div class="label">Pending approvals</div>
          <div class="value" id="kpiPending">—</div>
          <div class="muted" id="kpiPendingBreak">—</div>
        </div>

        <div class="kpi">
          <div class="label">Bookings (7d)</div>
          <div class="value" id="kpiBookings">—</div>
          <div class="muted" id="kpiBookingsBreak">—</div>
        </div>

        <div class="kpi">
          <div class="label">On-time % (7d)</div>
          <div class="value" id="kpiOnTime">—</div>
        </div>

        <div class="kpi">
          <div class="label">Active materials</div>
          <div class="value" id="kpiMaterials">—</div>
        </div>
      </div>

      <div class="charts">
        <div class="chart-card">
          <h4 class="chart-title">Bookings per day (last 7)</h4>
          <canvas id="chBookings"></canvas>
        </div>

        <div class="chart-card">
          <h4 class="chart-title">On-time % per day</h4>
          <canvas id="chOnTime"></canvas>
        </div>
      </div>

    </div>
  </section>

  <!-- Approvals -->
  <section class="panel" data-panel="approvals">
    <div class="card card-gradient pad">

      <div class="row wrap" style="gap:10px;">
        <select id="apRole" class="btn">
          <option value="team_leader">Team Leaders</option>
          <option value="instructor">Instructors</option>
          <option value="client">Clients</option>
        </select>

        <button id="apRefresh" class="btn">Refresh</button>
        <div id="apKpis" class="muted" style="margin-left:auto;"></div>
      </div>

      <div id="apList" class="spaced"></div>

    </div>
  </section>

  <!-- Assignments -->
  <section class="panel" data-panel="assign">
    <div class="card card-gradient pad">

      <div class="grid-3">

        <div>
          <h3>Assign TL → Zone</h3>
          <div class="row wrap" style="gap:8px;">
            <select id="tlUser" class="btn" style="min-width:180px;"></select>
            <button id="tlAssign" class="btn primary">Assign</button>
          </div>
          <div id="tlList" class="spaced"></div>
        </div>

        <div>
          <h3>Assign Instructor</h3>
          <div class="row wrap" style="gap:8px;">
            <select id="insUser" class="btn" style="min-width:180px;"></select>
            <select id="insTL" class="btn" style="min-width:180px;"></select>
            <button id="insAssign" class="btn primary">Assign</button>
          </div>
          <div id="insList" class="spaced"></div>
        </div>

        <div>
          <h3>Assign Client</h3>
          <div class="row wrap" style="gap:8px;">
            <select id="cliUser" class="btn" style="min-width:180px;"></select>
            <select id="cliInstr" class="btn" style="min-width:180px;"></select>
            <button id="cliAssign" class="btn primary">Assign</button>
          </div>
          <div id="cliList" class="spaced"></div>
        </div>

      </div>

    </div>
  </section>

  <!-- Materials -->
  <section class="panel" data-panel="materials">
    <div class="card card-gradient pad">

      <div class="row wrap" style="gap:10px;">
        <button id="matRefresh" class="btn">Refresh</button>

        <label class="pill">
          <input id="matShowPending" type="checkbox" checked>
          &nbsp;Pending only
        </label>
      </div>

      <div id="matList" class="spaced"></div>

    </div>
  </section>

  <!-- Messages -->
  <section class="panel" data-panel="messages">
    <div class="card card-gradient pad">

      <div class="grid-2">

        <aside>
          <div class="row wrap" style="gap:10px;">
            <select id="msgMode" class="btn" style="min-width:140px;">
              <option value="user">To user</option>
              <option value="role">To role</option>
              <option value="zone">To zone</option>
              <option value="all">Broadcast all</option>
            </select>

            <select id="msgRole" class="btn" style="display:none; min-width:160px;">
              <option value="manager">Managers</option>
              <option value="admin" selected>Admins</option>
              <option value="team_leader">Team Leaders</option>
              <option value="instructor">Instructors</option>
              <option value="client">Clients</option>
            </select>
          </div>

          <input id="searchUser" class="btn" placeholder="Search user…">
          <div id="threadList" class="spaced"></div>
        </aside>

        <section>
          <div id="threadBox"
               style="height:48vh; overflow:auto; border:1px solid var(--border);
                      border-radius:12px; padding:12px; background:var(--bg-elev);">
          </div>

          <div class="row" style="gap:12px; margin-top:12px;">
            <textarea id="msgBody" rows="2" class="btn" style="flex:1;" placeholder="Type a message…"></textarea>
            <button id="sendMsg" class="btn primary">Send</button>
          </div>
        </section>

      </div>

    </div>
  </section>

  <!-- Clock -->
  <section class="panel" data-panel="clock">
    <div class="card card-gradient pad">
      <div class="row" style="gap:12px;">
        <button id="clockIn" class="btn primary">Clock In</button>
        <button id="clockOut" class="btn">Clock Out</button>
        <div id="clockStatus" class="muted">—</div>
      </div>
    </div>
  </section>

  <!-- Profile -->
  <section class="panel" data-panel="profile">
    <div class="card card-gradient pad">

      <div class="row" style="gap:18px;">
        <img id="avatar" class="avatar" alt="avatar">

        <div class="col">
          <input id="avatarFile" type="file" accept="image/*" class="btn">
          <small class="muted">JPG/PNG up to 5MB</small>
        </div>
      </div>

      <div class="row wrap" style="gap:12px; margin-top:16px;">
        <input id="name" placeholder="Full name" class="btn" style="min-width:220px;">
        <input id="phone" placeholder="Phone (+27…)" class="btn" style="min-width:200px;">
        <button id="saveProfile" class="btn primary">Save profile</button>
      </div>

    </div>
  </section>

</main>

<footer class="footer">
  A property of <span class="glow">SAHA</span>
</footer>

<!-- THEME TOGGLE SCRIPT -->
<script>
  const btn = document.getElementById("themeToggleBtn");
  const icon = document.getElementById("themeIcon");

  function updateIcon(theme) {
    if (theme === "dark") {
      icon.innerHTML = `
        <path d="M21 12.79A9 9 0 0 1 11.21 3 7 7 0 1 0 21 12.79z" stroke-width="2"/>
      `;
    } else {
      icon.innerHTML = `
        <circle cx="12" cy="12" r="5" stroke-width="2"/>
      `;
    }
  }

  const saved = localStorage.getItem("theme");

  if (saved) {
    document.documentElement.dataset.theme = saved;
    updateIcon(saved);
  }

  btn.addEventListener("click", () => {
    const current = document.documentElement.dataset.theme === "dark" ? "dark" : "light";
    const next = current === "dark" ? "light" : "dark";

    document.documentElement.dataset.theme = next;
    localStorage.setItem("theme", next);

    updateIcon(next);
  });
</script>

</body>
</html>
