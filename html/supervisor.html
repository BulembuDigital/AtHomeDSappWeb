<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Supervisor · At Home Driving School</title>

  <!-- Icons -->
  <link rel="icon" type="image/png" href="/icons/favicon-32.png">
  <link rel="apple-touch-icon" href="/icons/apple-icon-180.png">

  <!-- Base styles -->
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/ui-sparkle.css">
  <link rel="stylesheet" href="/css/splash.css">

  <!-- Theme + Sparkle + Splash -->
  <script defer src="/js/theme.js"></script>
  <script defer src="/js/ui-sparkle.js"></script>
  <script defer src="/js/splash.js"></script>

  <!-- Supabase -->
  <script defer src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <!-- SDK -->
  <script defer src="/js/supabaseClient.js"></script>
  <script type="module" src="/js/sdk/auth.js"></script>
  <script type="module" src="/js/sdk/profiles.js"></script>
  <script type="module" src="/js/sdk/assignments.js"></script>
  <script type="module" src="/js/sdk/materials.js"></script>
  <script type="module" src="/js/sdk/messages.js"></script>
  <script type="module" src="/js/sdk/analytics.js"></script>
  <script type="module" src="/js/sdk/liveLocations.js"></script>
  <script type="module" src="/js/sdk/routes.js"></script>
  <script type="module" src="/js/sdk/clockEvents.js"></script>

  <!-- Page logic -->
  <script type="module" src="/js/supervisor.js"></script>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    .tabs {
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      border-bottom:1px solid var(--border);
    }
    .tab {
      padding:10px 16px;
      border-radius:12px 12px 0 0;
      font-weight:700;
      cursor:pointer;
      color:var(--text-dim);
      border:1px solid transparent;
    }
    .tab.active {
      background:var(--bg-elev);
      color:var(--text);
      border-color:var(--border) var(--border) transparent var(--border);
      position:relative;
    }
    .tab.active::after {
      content:"";
      position:absolute;
      left:12px;
      right:12px;
      bottom:-1px;
      height:2px;
      background:var(--accent);
    }

    .panel {
      display:none;
      padding-top:20px;
    }
    .panel.active {
      display:block;
      animation:fade .25s ease;
    }
    @keyframes fade { from {opacity:0;} to {opacity:1;} }

    .avatar {
      width:92px;
      height:92px;
      border-radius:50%;
      object-fit:cover;
      border:2px solid var(--border);
    }

    #sup-map {
      width:100%;
      height:420px;
      border-radius:16px;
      border:1px solid var(--border);
    }

    .list-row {
      padding:12px 0;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:1px solid var(--border);
    }

    .msg-wrap {
      display:grid;
      grid-template-columns:280px 1fr;
      gap:12px;
    }
    @media (max-width:900px){
      .msg-wrap { grid-template-columns:1fr; }
    }

    .thread-item {
      padding:10px;
      border-radius:12px;
      background:var(--bg-elev);
      border:1px solid var(--border);
      cursor:pointer;
    }

    .msg {
      max-width:80%;
      padding:10px 14px;
      margin-bottom:10px;
      border-radius:12px;
    }
    .msg.me {
      margin-left:auto;
      background:color-mix(in oklab, var(--accent) 20%, var(--bg-elev));
    }
    .msg.other {
      background:var(--bg-elev);
      border:1px solid var(--border);
    }
  </style>
</head>

<body class="soft-page">

<!-- Splash Screen -->
<div class="splash-overlay show">
  <div class="splash">
    <div class="logo-wrap">
      <img class="logo" src="/icons/logo-512.png" alt="Logo">
      <div class="glow"></div>
      <div class="bloom"></div>
    </div>
    <div class="loader">
      <div class="dot"></div><div class="dot"></div><div class="dot"></div>
    </div>
  </div>
</div>

<header class="header card-gradient">
  <div class="brand"><span class="dot"></span> Supervisor Dashboard</div>

  <div class="row" style="gap:12px;">
    <button class="btn" onclick="location.href='/html/home.html'">Home</button>
    <button class="btn danger" id="logoutBtn">Logout</button>
    <button class="theme-toggle" data-theme-toggle></button>
  </div>
</header>

<main class="container">

  <!-- Tabs -->
  <nav class="tabs" id="tabs">
    <button class="tab active" data-tab="analytics">Analytics</button>
    <button class="tab" data-tab="approvals">Approvals</button>
    <button class="tab" data-tab="live">Live Map</button>
    <button class="tab" data-tab="routes">Routes</button>
    <button class="tab" data-tab="messages">Messages</button>
    <button class="tab" data-tab="clock">Clock Events</button>
    <button class="tab" data-tab="profile">Profile</button>
  </nav>

  <!-- ANALYTICS -->
  <section class="panel active" data-panel="analytics">
    <div class="card card-gradient pad">
      <h2>System-wide Analytics</h2>

      <div class="kpis" style="margin-top:14px;">
        <div class="kpi">
          <div class="label">Total Users</div>
          <div class="value" id="anTotalUsers">—</div>
        </div>
        <div class="kpi">
          <div class="label">Active Lessons (today)</div>
          <div class="value" id="anLessonsToday">—</div>
        </div>
        <div class="kpi">
          <div class="label">Uploads Pending</div>
          <div class="value" id="anMatPending">—</div>
        </div>
        <div class="kpi">
          <div class="label">TL / Instructor Activity</div>
          <div class="value" id="anActivity">—</div>
        </div>
      </div>

      <button id="anRefresh" class="btn" style="margin-top:12px;">Refresh</button>
    </div>
  </section>

  <!-- APPROVALS -->
  <section class="panel" data-panel="approvals">
    <div class="card card-gradient pad">

      <h2>Approve Admins / Managers / TLs</h2>

      <div class="row wrap" style="gap:10px;">
        <select id="apRole" class="btn">
          <option value="admin">Admins</option>
          <option value="manager">Managers</option>
          <option value="team_leader">Team Leaders</option>
        </select>

        <button id="apRefresh" class="btn">Refresh</button>
      </div>

      <div id="apList" class="spaced"></div>

    </div>
  </section>

  <!-- LIVE MAP -->
  <section class="panel" data-panel="live">
    <div class="card card-gradient pad">
      <h2>Live Instructor Locations</h2>
      <div id="sup-map"></div>
    </div>
  </section>

  <!-- ROUTES -->
  <section class="panel" data-panel="routes">
    <div class="card card-gradient pad">
      <h2>All Routes (created by TL)</h2>

      <button id="routesRefresh" class="btn">Refresh</button>
      <div id="routesList" class="spaced"></div>
    </div>
  </section>

  <!-- MESSAGES -->
  <section class="panel" data-panel="messages">
    <div class="card card-gradient pad">

      <h2>System Messaging</h2>

      <div class="row wrap" style="gap:10px;">
        <select id="msgMode" class="btn">
          <option value="all">Broadcast All</option>
          <option value="role">To Role</option>
          <option value="user">To User</option>
        </select>

        <select id="msgRole" class="btn" style="display:none;">
          <option value="admin">Admins</option>
          <option value="manager">Managers</option>
          <option value="team_leader">Team Leaders</option>
          <option value="instructor">Instructors</option>
          <option value="client">Clients</option>
        </select>
      </div>

      <div class="msg-wrap" style="margin-top:16px;">
        <aside>
          <input id="searchUser" class="btn" placeholder="Search user..."/>
          <div id="threadList" class="spaced"></div>
        </aside>

        <section>
          <div id="threadBox"
               style="height:48vh;overflow:auto;border:1px solid var(--border);
               border-radius:12px;padding:12px;background:var(--bg-elev);"></div>

          <div class="row" style="gap:10px;margin-top:12px;">
            <textarea id="msgBody" rows="2" class="btn" style="flex:1;" placeholder="Message…"></textarea>
            <button id="sendMsg" class="btn primary">Send</button>
          </div>
        </section>
      </div>

    </div>
  </section>

  <!-- CLOCK EVENTS -->
  <section class="panel" data-panel="clock">
    <div class="card card-gradient pad">
      <h2>Clock Events Log</h2>
      <button id="clockRefresh" class="btn">Refresh</button>
      <div id="clockList" class="spaced"></div>
    </div>
  </section>

  <!-- PROFILE -->
  <section class="panel" data-panel="profile">
    <div class="card card-gradient pad">

      <h2>Profile</h2>

      <div class="row" style="gap:18px;">
        <img id="avatar" class="avatar" alt="avatar"/>
        <div class="col">
          <input id="avatarFile" type="file" accept="image/*" class="btn"/>
          <small class="muted">JPG/PNG up to 5MB</small>
        </div>
      </div>

      <div class="row wrap" style="gap:12px;margin-top:16px;">
        <input id="name" class="btn" placeholder="Full name" style="min-width:220px;"/>
        <input id="phone" class="btn" placeholder="Phone (+27…)" style="min-width:200px;"/>
        <button id="saveProfile" class="btn primary">Save Profile</button>
      </div>

    </div>
  </section>

</main>

<footer class="footer">A property of <span class="glow">SAHA</span></footer>

<!-- Logout -->
<script type="module">
  import { logout } from "/js/sdk/auth.js";
  document.getElementById("logoutBtn").onclick = logout;
</script>

</body>
</html>
