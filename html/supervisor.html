<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Supervisor · At Home Driving School</title>

  <link rel="stylesheet" href="/css/base.css">

  <!-- Theme + Splash -->
  <script defer src="/js/theme.js"></script>
  <script defer src="/js/splash.js"></script>

  <!-- Supabase -->
  <script defer src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <!-- SDK modules -->
  <script defer src="/js/sdk/supabaseClient.js"></script>
  <script type="module" src="/js/sdk/auth.js"></script>
  <script type="module" src="/js/sdk/profiles.js"></script>
  <script type="module" src="/js/sdk/liveLocations.js"></script>
  <script type="module" src="/js/sdk/messages.js"></script>
  <script type="module" src="/js/sdk/clockEvents.js"></script>

  <!-- Page Logic -->
  <script type="module" src="/js/supervisor.js"></script>

  <!-- Leaflet Map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    .tabs {
      display:flex; gap:6px; flex-wrap:wrap;
      border-bottom:1px solid var(--border);
    }
    .tab {
      padding:10px 16px;
      border-radius:12px 12px 0 0;
      cursor:pointer;
      font-weight:700;
      color:var(--text-dim);
      border:1px solid transparent;
    }
    .tab.active {
      background:var(--bg-elev);
      color:var(--text);
      border-color:var(--border) var(--border) transparent var(--border);
      position:relative;
    }
    .tab.active::after {
      content:"";
      position:absolute;
      left:12px; right:12px; bottom:-1px;
      height:2px; background:var(--accent);
    }

    .panel { display:none; padding-top:20px; }
    .panel.active { display:block; animation:fade .25s; }

    @keyframes fade { from{opacity:0;} to{opacity:1;} }

    .avatar {
      width:92px;height:92px;object-fit:cover;
      border-radius:50%;border:2px solid var(--border);
    }

    .list-row {
      padding:12px 0; border-bottom:1px solid var(--border);
      display:flex; justify-content:space-between; align-items:center;
    }

    .msg-wrap { display:grid; grid-template-columns:300px 1fr; gap:12px; }
    @media (max-width:900px){ .msg-wrap{ grid-template-columns:1fr; } }

    .thread-item {
      padding:10px;border-radius:12px;
      background:var(--bg-elev);border:1px solid var(--border);
      cursor:pointer;
    }

    .msg {
      max-width:80%;padding:10px 14px;margin-bottom:10px;
      border-radius:12px;
    }
    .msg.me {
      margin-left:auto;
      background:color-mix(in oklab,var(--accent) 20%,var(--bg-elev));
    }
    .msg.other {
      background:var(--bg-elev);border:1px solid var(--border);
    }

  </style>
</head>

<body>

<header class="header card-gradient">
  <div class="brand"><span class="dot"></span> At Home Driving School</div>
  <div class="row">
    <button class="btn" onclick="location.href='/html/home.html'">Home</button>
    <button class="btn" onclick="location.href='/html/login.html'">Switch</button>
    <button class="theme-toggle" data-theme-toggle></button>
  </div>
</header>

<main class="container">

  <!-- Tabs -->
  <nav class="tabs" id="tabs">
    <button class="tab active" data-tab="map">Live Map</button>
    <button class="tab" data-tab="approvals">Admin Approvals</button>
    <button class="tab" data-tab="users">All Users</button>
    <button class="tab" data-tab="messages">Messages</button>
    <button class="tab" data-tab="clock">Clock</button>
    <button class="tab" data-tab="profile">Profile</button>
  </nav>

  <!-- LIVE MAP -->
  <section class="panel active" data-panel="map">
    <div class="card card-gradient pad">
      <h2 style="margin-top:0;">Live Map — All Locations</h2>
      <div id="sup-map" style="height:65vh;border-radius:14px;overflow:hidden;"></div>
    </div>
  </section>

  <!-- APPROVALS (Admins only) -->
  <section class="panel" data-panel="approvals">
    <div class="card card-gradient pad">

      <h2>Approve Admins</h2>

      <button id="apRefresh" class="btn">Refresh</button>
      <div id="apList" class="spaced"></div>

    </div>
  </section>

  <!-- USERS OVERVIEW -->
  <section class="panel" data-panel="users">
    <div class="card card-gradient pad">

      <h2>All Users</h2>

      <input id="searchUser" class="btn" placeholder="Search by name/email…"/>
      <div id="userList" class="spaced"></div>

    </div>
  </section>

  <!-- MESSAGES -->
  <section class="panel" data-panel="messages">
    <div class="card card-gradient pad">

      <div class="msg-wrap">

        <!-- Thread List -->
        <aside>
          <select id="msgMode" class="btn" style="min-width:160px;">
            <option value="user">To user</option>
            <option value="role">To role</option>
            <option value="zone">To zone</option>
            <option value="all">Broadcast all</option>
          </select>

          <select id="msgRole" class="btn" style="display:none; min-width:160px;">
            <option value="admin">Admins</option>
            <option value="manager">Managers</option>
            <option value="team_leader">Team Leaders</option>
            <option value="instructor">Instructors</option>
            <option value="client">Clients</option>
          </select>

          <input id="msgSearch" class="btn" placeholder="Search users…"/>

          <div id="threadList" class="spaced"></div>
        </aside>

        <!-- Thread -->
        <section>
          <div id="threadBox"
               style="height:48vh;overflow:auto;border:1px solid var(--border);
                      border-radius:12px;padding:12px;background:var(--bg-elev);"></div>

          <div class="row" style="gap:10px;margin-top:12px;">
            <textarea id="msgBody" class="btn" style="flex:1" rows="2"
              placeholder="Type a message…"></textarea>
            <button id="sendMsg" class="btn primary">Send</button>
          </div>
        </section>

      </div>

    </div>
  </section>

  <!-- CLOCK EVENTS -->
  <section class="panel" data-panel="clock">
    <div class="card card-gradient pad">
      <div class="row" style="gap:12px;">
        <button id="clockIn" class="btn primary">Clock In</button>
        <button id="clockOut" class="btn">Clock Out</button>
        <div id="clockStatus" class="muted">—</div>
      </div>
    </div>
  </section>

  <!-- PROFILE -->
  <section class="panel" data-panel="profile">
    <div class="card card-gradient pad">

      <div class="row" style="gap:18px;">
        <img id="avatar" class="avatar"/>
        <div class="col">
          <input id="avatarFile" type="file" accept="image/*" class="btn"/>
          <small class="muted">JPG/PNG up to 5MB</small>
        </div>
      </div>

      <div class="row wrap" style="gap:12px;margin-top:16px;">
        <input id="name" class="btn" placeholder="Full name" style="min-width:220px;"/>
        <input id="phone" class="btn" placeholder="Phone (+27…)" style="min-width:200px;"/>
        <button id="saveProfile" class="btn primary">Save Profile</button>
      </div>

    </div>
  </section>

</main>

<footer class="footer">A property of <span class="glow">SAHA</span></footer>

</body>
</html>
